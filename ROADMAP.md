# ConvertEasy 开发路线图

> 最后更新: 2025-12-29

## 📊 功能完成度概览

| 模块          | 完成度 | 状态        |
| ------------- | ------ | ----------- |
| PDF 转换      | 90%    | 🟢 可用     |
| 音频转换      | 85%    | 🟡 基本可用 |
| Markdown 转换 | 100%   | 🟢 已完成   |
| 文档互转      | 60%    | 🟠 需改进   |
| 小程序 UI/UX  | 70%    | 🟡 可优化   |

---

## 🔴 P0 - 紧急/阻断性问题

> 这些问题会导致功能完全不可用或严重影响用户体验

### Issue #1: Markdown 转换功能完全缺失 ✅

- **模块**: 文档转换
- **影响**: 用户无法进行任何 Markdown 相关转换
- **现状**:
  - ✅ `.md` 已添加到 `ALLOWED_DOC_EXT`
  - ✅ 创建了 `md_to_html.py` 脚本（markdown库 + 扩展）
  - ✅ 创建了 `md_to_pdf.py` 脚本（weasyprint + HTML转PDF）
  - ✅ 创建了 `md_to_docx.py` 脚本（python-docx）
  - ✅ 更新了 `PYTHON_CONVERSIONS` 映射
  - ✅ 更新了前端格式配置（formats.js）
  - **完成日期**: 2025-12-28
- **状态**: ✅ 已解决

### Issue #2: WMA 音频格式声称支持但实际未实现 ✅

- **模块**: 音频转换
- **影响**: 用户选择 WMA 转换会失败或产生错误输出
- **现状**: 已完成
  - ✅ 添加了 WMA 的 FFmpeg 参数配置到 `converter.py`
  - ✅ 验证了 WMA 编解码器可用性
  - ✅ 配置了合适的比特率和编码参数
- **完成日期**: 2025-12-28
- **状态**: ✅ 已解决

### Issue #3: Word→HTML 转换脚本存在逻辑 Bug ✅

- **模块**: 文档转换
- **影响**: 转换内容可能错乱
- **现状**: 已完成
  - ✅ 修复了 `doc_to_html.py` 第46行的索引计算错误
  - ✅ 重写了段落遍历逻辑，改用正确的元素迭代方式
  - ✅ 添加了单元测试验证转换正确性
  - ✅ 测试多种 Word 文档格式通过
- **完成日期**: 2025-12-28
- **状态**: ✅ 已解决

---

## 🟠 P1 - 高优先级问题

> 这些问题严重影响转换质量，用户可能会抱怨结果不可用

### Issue #4: PDF→Word 图片完全丢失 ✅

- **模块**: PDF 转换
- **影响**: 转换后的 Word 文档缺失所有图片
- **现状**: 已解决
  - ✅ 使用 pdf2docx 库的内置图片提取功能
  - ✅ 优化了参数：`extract_stream_table=True`, `min_image_width=40`, `min_image_height=40`, `extract_image_dpi=200`
  - ✅ 启用了多处理加速：`multi_processing=True`
  - ✅ 自动处理图片格式兼容性
- **完成日期**: 2025-12-28
- **状态**: ✅ 已解决

### Issue #5: PDF→Word 格式/样式全部丢失 🟡

- **模块**: PDF 转换
- **影响**: 输出文档无格式，仅纯文本
- **现状**: 部分改进
  - ✅ 引入了 `pdf2docx` 库实现格式保留
  - ✅ 优化了表格检测参数：`table_border_threshold=0.5`, `connected_border_tolerance=4.0`, `max_border_width=3.0`
  - ✅ 改进了行检测：`line_overlap_threshold=0.4`, `line_separate_threshold=12.0`, `line_break_free_space_ratio=0.15`
  - ✅ 启用了样式保留：`keep_text_color=True`, `keep_text_style=True`, `keep_text_bold=True`, `keep_text_italic=True`, `keep_font_size=True`
  - ✅ 添加了后处理模块：规范化表格、清理多余换行、修复行距、统一字体
  - 🟡 **已知问题**：某些复杂PDF的格式仍可能混乱，需要进一步优化
- **优化方向**:
  - [ ] 根据不同PDF结构自适应调整参数
  - [ ] 添加更智能的表格检测和修复逻辑

  - [ ] 用户反馈式参数微调
- **完成日期**: 2025-12-28（持续改进中）
- **状态**: 🟡 部分完成，需持续优化

### Issue #6: PDF→Excel 只提取第一个表格

- **模块**: PDF 转换
- **影响**: 多表格 PDF 丢失大部分数据
- **现状**:

  ```python
  # pdf_to_xls.py
  df = pd.DataFrame(tables[0][1:], columns=tables[0][0])  # 只处理tables[0]
  ```

- **需要**:
  - [ ] 遍历所有表格
  - [ ] 每个表格写入独立 Sheet
  - [ ] 添加表格来源页码信息

### Issue #7: PDF→PPT 转换质量极差 ✅

- **模块**: PDF 转换
- **影响**: 输出 PPT 几乎不可用
- **现状**: 已完成（图像级转换方案）
  - ❌ **LibreOffice headless 方案已废弃**：
    - 原因：生成的PPTX文件兼容性问题严重
    - 问题：需要额外安装LibreOffice，部署复杂
  - ✅ **当前方案：图像级转换**（2025-12-29）：
    - 策略：将 PDF 每页渲染为高质量图片，然后插入到 PPT 中
    - 技术栈：`pdf2image` + `python-pptx` + `poppler`
    - 实现状态：
      - ✅ 脚本已完成并测试通过
      - ✅ poppler 依赖已安装配置
      - ✅ 支持自定义 DPI（150/200/300）
      - ✅ 自动缩放和居中，适配幻灯片尺寸
      - ✅ 完美保留 PDF 视觉效果（100% 还原）
    - 优势：
      - 视觉还原度极高，所见即所得
      - 实现简单稳定，无需复杂依赖
      - 转换速度快，质量可控
  - ⚠️ **已知限制**：
    - 输出的 PPT 内容为图片，**无法编辑文本和元素**
    - 适合用于展示和演示，不适合需要二次编辑的场景
    - 文件体积较大（取决于 DPI 设置）
  - 🔧 **未来优化方向**：
    - [ ] 提供"可编辑模式"选项（尝试 OCR + 文本识别）
    - [ ] 添加压缩选项以减小文件体积
    - [ ] 支持批量转换和进度显示
    - [ ] 探索 PDF 结构化解析方案（保留文本可编辑性）
- **完成日期**: 2025-12-29
- **状态**: ✅ 已完成（当前方案满足展示需求，可编辑性待未来增强）

### Issue #8: 扫描件/图片 PDF 无法处理

- **模块**: PDF 转换
- **影响**: 大量扫描文档无法转换
- **现状**: 只输出"无文本内容"提示
- **需要**:
  - [ ] 集成 OCR 引擎（Tesseract / PaddleOCR）
  - [ ] 添加图片预处理（去噪、二值化）
  - [ ] 支持多语言 OCR

---

## 🟡 P2 - 中优先级问题

> 这些问题影响用户体验但不阻断核心功能

### Issue #9: HTML→PDF 中文字体支持问题

- **模块**: 文档转换
- **影响**: 中文可能显示为方块或乱码
- **现状**: xhtml2pdf 默认字体不支持中文
- **需要**:
  - [ ] 注册中文字体（SimSun, Microsoft YaHei）
  - [ ] 添加字体回退机制

### Issue #10: HTML→Word 图片未嵌入

- **模块**: 文档转换
- **影响**: HTML 中的图片丢失
- **现状**: `html_to_word.py` 未处理 `<img>` 标签
- **需要**:
  - [ ] 下载/读取图片资源
  - [ ] 使用 python-docx 插入图片

### Issue #11: 音频转换丢失元数据

- **模块**: 音频转换
- **影响**: 转换后丢失歌手、专辑、封面等信息
- **现状**: FFmpeg 命令未包含元数据复制参数
- **需要**:
  - [ ] 添加 `-map_metadata 0` 参数
  - [ ] 或使用 mutagen 库迁移标签

### Issue #12: PDF→TXT 缺少降级处理

- **模块**: PDF 转换
- **影响**: 特定 PDF 可能转换失败
- **现状**: `pdf_to_txt.py` 只用 pdfplumber，无备选
- **需要**:
  - [ ] 添加 pdfminer 和 PyMuPDF 作为备选
  - [ ] 参考 `pdf_to_doc.py` 的多引擎策略

### Issue #13: 文件大小限制错误提示不友好

- **模块**: 通用
- **影响**: 用户不理解为何上传失败
- **现状**: 可能返回通用 500 错误
- **需要**:
  - [ ] 在上传前检查文件大小
  - [ ] 返回清晰的大小限制提示

---

## 🟢 P3 - 低优先级/增强功能

> 这些是改进项，当前功能可用

### Issue #14: 转换进度实时反馈

- **模块**: 通用
- **现状**: 用户只能轮询状态，无进度百分比
- **需要**:
  - [ ] 在长时间转换中提供进度更新
  - [ ] 考虑 WebSocket 推送

### Issue #15: 批量转换支持

- **模块**: 通用
- **现状**: 一次只能转换一个文件
- **需要**:
  - [ ] 支持多文件上传
  - [ ] 批量任务管理

### Issue #16: 转换结果预览

- **模块**: 通用
- **现状**: 只能下载后查看
- **需要**:
  - [ ] 在线预览转换结果
  - [ ] 支持常见格式的预览

### Issue #17: 转换历史记录

- **模块**: 通用
- **现状**: 任务完成后无法查看历史
- **需要**:
  - [ ] 持久化任务记录
  - [ ] 历史列表页面

### Issue #18: 音频采样率/比特率可配置

- **模块**: 音频转换
- **现状**: 使用固定参数
- **需要**:
  - [ ] 允许用户选择质量级别
  - [ ] 高级用户可自定义参数

### Issue #19: 添加更多格式支持

- **模块**: 通用
- **待添加格式**:
  - [ ] EPUB（电子书）
  - [ ] MOBI（Kindle 电子书）
  - [ ] LaTeX
  - [ ] 图片格式互转（PNG, JPG, WEBP）

---

## 📱 小程序 UI/UX 问题

> 前端完成度约 70%，基础功能可用但用户体验有待提升

### 当前完成情况

**已实现 ✅**:

- 首页分类导航（文档/音频）
- 源格式 → 目标格式选择流程
- 文件选择（从微信聊天）
- 批量文件列表展示
- 转换进度条显示
- 文件预览/下载/分享
- 音频播放器（自定义 UI）
- 渐变背景视觉设计

**存在问题 ❌**:

- 首页虚假宣传（声称支持图片/视频但实际未实现）
- 无引导式用户教程
- 错误提示不够友好
- 无网络状态检测
- 文件操作按钮过于密集

---

### Issue #20: 首页格式标签与实际能力不符（虚假宣传）

- **模块**: 小程序 - 首页
- **优先级**: P1
- **影响**: 用户预期落空，影响信任度
- **现状**:

  ```html
  <!-- index.wxml 显示了未实现的格式 -->
  <view class="format-tag">JPG/PNG</view>
  <view class="format-tag">WebP</view>
  <view class="format-tag">MP4</view>
  <view class="format-tag">AVI</view>
  <view class="format-tag">MOV</view>
  ```

  - 这些格式后端完全未支持
- **需要**:
  - [ ] 移除未实现的格式标签
  - [ ] 或标注"即将支持"
  - [ ] 动态从后端加载支持的格式列表

### Issue #21: 音频页面硬编码格式列表

- **模块**: 小程序 - 音频页
- **优先级**: P2
- **影响**: 维护困难，前后端不同步
- **现状**:

  ```html
  <!-- audio.wxml 硬编码了7个格式项 -->
  <view class="format-item" bindtap="selectSourceFormat" data-index="0"
    >MP3</view
  >
  <view class="format-item" bindtap="selectSourceFormat" data-index="1"
    >WAV</view
  >
  ...
  ```

  - 应该像文档页一样使用 `wx:for` 动态渲染
- **需要**:
  - [ ] 改为动态渲染 `{{sourceFormats}}`
  - [ ] 统一文档页和音频页的实现方式

### Issue #22: 缺少网络状态检测和离线提示

- **模块**: 小程序 - 通用
- **优先级**: P2
- **影响**: 网络异常时用户困惑
- **现状**:
  - 无网络时直接请求失败
  - 错误提示不明确
- **需要**:
  - [ ] 使用 `wx.onNetworkStatusChange` 监听网络
  - [ ] 无网络时禁用上传按钮并提示
  - [ ] 添加重试机制

### Issue #23: 文件操作按钮过于密集

- **模块**: 小程序 - 文件列表
- **优先级**: P2
- **影响**: 小屏设备点击困难
- **现状**:

  ```html
  <view class="action-row">
    <button size="mini">删除</button>
    <button size="mini">预览</button>
    <button size="mini">下载</button>
    <button size="mini">分享</button>
  </view>
  ```

  - 4 个按钮挤在一行
- **需要**:
  - [ ] 使用 ActionSheet 或更多菜单收纳
  - [ ] 或改为图标按钮减少宽度
  - [ ] 添加滑动操作（左滑删除等）

### Issue #24: 缺少新手引导

- **模块**: 小程序 - 通用
- **优先级**: P3
- **影响**: 新用户可能不知道如何操作
- **现状**: 直接进入功能页，无任何引导
- **需要**:
  - [ ] 首次使用时显示操作引导
  - [ ] 添加"如何使用"帮助入口
  - [ ] 关键步骤添加提示气泡

### Issue #25: 无转换历史页面

- **模块**: 小程序 - 功能缺失
- **优先级**: P3
- **影响**: 用户无法找回之前的转换结果
- **现状**: 刷新或退出后历史丢失
- **需要**:
  - [ ] 使用本地存储保存历史
  - [ ] 添加历史记录页面
  - [ ] 支持清空历史

### Issue #26: 下载体验不佳

- **模块**: 小程序 - 文件下载
- **优先级**: P2
- **影响**: 用户获取文件麻烦
- **现状**:
  - 小程序限制无法直接保存到相册/文件管理
  - 当前方案是复制链接让用户去浏览器下载
- **需要**:
  - [ ] 对于图片/视频使用 `saveImageToPhotosAlbum` / `saveVideoToPhotosAlbum`
  - [ ] 引导用户"转发给文件传输助手"
  - [ ] 优化复制链接的文案提示

### Issue #27: 缺少深色模式支持

- **模块**: 小程序 - 视觉
- **优先级**: P3
- **影响**: 夜间使用体验差
- **现状**: 只有浅色主题
- **需要**:
  - [ ] 检测系统主题 `wx.getSystemInfoSync().theme`
  - [ ] 添加深色模式样式变量
  - [ ] 支持手动切换

### Issue #28: 格式图标使用 Emoji 不够专业

- **模块**: 小程序 - 视觉
- **优先级**: P3
- **影响**: 视觉一致性不够
- **现状**: 使用 📄 🎵 等 emoji 作为图标
- **需要**:
  - [ ] 替换为 SVG/iconfont 图标
  - [ ] 统一图标风格
  - [ ] 添加格式特定图标（PDF 红色、Word 蓝色等）

### Issue #29: 无加载骨架屏

- **模块**: 小程序 - 体验
- **优先级**: P3
- **影响**: 加载时页面空白
- **现状**: 等待数据时无任何占位
- **需要**:
  - [ ] 添加骨架屏组件
  - [ ] 文件列表加载占位
  - [ ] 格式列表加载占位

### Issue #30: 分享卡片信息单一

- **模块**: 小程序 - 分享
- **优先级**: P3
- **影响**: 分享吸引力不足
- **现状**:

  ```javascript
  onShareAppMessage() {
    return {
      title: '全能格式转换工具',
      path: '/pages/index/index'
    };
  }
  ```

  - 无自定义图片，无动态内容
- **需要**:
  - [ ] 添加分享图片
  - [ ] 根据页面动态生成标题
  - [ ] 支持分享到朋友圈（需要 `onShareTimeline`）

---

## 📋 技术债务

### TD-1: 测试覆盖率不足

- 许多转换脚本缺少单元测试
- 需要添加边界条件测试

### TD-2: 错误处理不统一

- 各脚本错误处理方式不一致
- 需要统一错误格式和日志

### TD-3: 配置硬编码

- 部分参数硬编码在脚本中
- 应迁移到配置文件

### TD-4: 缺少性能监控

- 无转换耗时统计
- 无资源使用监控

### TD-5: 前端代码重复

- `document.js` 和 `audio.js` 有大量重复逻辑
- 应抽取公共组件和 mixins

### TD-6: 样式不统一

- `app.wxss` 和各页面 wxss 存在样式冲突
- 部分页面覆盖了全局样式
- 需要统一设计系统

---

## 📝 开发建议优先级

```
1. P0 Issues (#1-#3) → 先修复阻断性问题
2. P1 Issues (#4-#8, #20) → 提升核心功能质量 + 修复虚假宣传
3. 技术债务 (TD-1~6) → 并行处理
4. P2 Issues (#9-#13, #21-#23, #26) → 逐步优化体验
5. P3 Issues (#14-#19, #24-#25, #27-#30) → 按需实现增强功能
```

---

## 🔗 相关文档

- [后端 README](./backend/README.md)
- [快速开始指南](./backend/QUICK_START.md)
- [API 测试说明](./backend/tests/POSTMAN_README.md)
- [小程序配置说明](./miniprogram/CONFIG.md)
