{
	"info": {
		"_postman_id": "converteasy-api-tests",
		"name": "ConvertEasy API Tests",
		"description": "ConvertEasy 文件转换服务 API 测试集合\n\n支持：\n- 文档转换（PDF/Word/Excel/PPT/TXT/HTML/Markdown）\n- 音频转换（MP3/WAV/AAC/FLAC/OGG/M4A/WMA）",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"variable": [
		{
			"key": "baseUrl",
			"value": "https://convertease.site",
			"type": "string"
		},
		{
			"key": "taskId",
			"value": "",
			"type": "string"
		},
		{
			"key": "projectRoot",
			"value": "/home/jared/converteasy/backend",
			"type": "string",
			"description": "项目根目录的绝对路径"
		}
	],
	"item": [
		{
			"name": "健康检查",
			"item": [
				{
					"name": "Health Check",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has ok=true', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.ok).to.eql(true);",
									"});",
									"",
									"pm.test('Service name is correct', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.service).to.eql('converteasy-backend');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/health",
							"host": ["{{baseUrl}}"],
							"path": ["health"]
						},
						"description": "检查服务是否正常运行"
					},
					"response": []
				},
				{
					"name": "Server Status",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Server is running', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.status).to.eql('running');",
									"});",
									"",
									"pm.test('Response contains system info', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('system');",
									"    pm.expect(jsonData).to.have.property('tasks');",
									"    pm.expect(jsonData).to.have.property('files');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/server-status",
							"host": ["{{baseUrl}}"],
							"path": ["server-status"]
						},
						"description": "获取服务器详细状态信息"
					},
					"response": []
				}
			],
			"description": "服务健康检查相关接口"
		},
		{
			"name": "格式支持查询",
			"item": [
				{
					"name": "Get All Supported Formats",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Contains document formats', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('document');",
									"    pm.expect(jsonData.document).to.have.property('allowedExtensions');",
									"    pm.expect(jsonData.document).to.have.property('supportedConversions');",
									"});",
									"",
									"pm.test('Contains audio formats', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('audio');",
									"    pm.expect(jsonData.audio).to.have.property('allowedExtensions');",
									"});",
									"",
									"pm.test('Markdown is supported', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.document.allowedExtensions).to.include('.md');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/supported-formats",
							"host": ["{{baseUrl}}"],
							"path": ["supported-formats"]
						},
						"description": "获取所有支持的文件格式"
					},
					"response": []
				},
				{
					"name": "Get Document Formats Only",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Only contains document formats', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('document');",
									"    pm.expect(jsonData).to.not.have.property('audio');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/supported-formats?category=document",
							"host": ["{{baseUrl}}"],
							"path": ["supported-formats"],
							"query": [
								{
									"key": "category",
									"value": "document"
								}
							]
						},
						"description": "仅获取文档格式支持"
					},
					"response": []
				}
			],
			"description": "查询支持的文件格式"
		},
		{
			"name": "Markdown 转换测试",
			"item": [
				{
					"name": "Detect Targets - MD File",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Source extension is md', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.sourceExtension).to.eql('md');",
									"});",
									"",
									"pm.test('Supports MD to HTML conversion', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.supportedTargets).to.include('html');",
									"});",
									"",
									"pm.test('Supports MD to PDF conversion', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.supportedTargets).to.include('pdf');",
									"});",
									"",
									"pm.test('Supports MD to DOCX conversion', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.supportedTargets).to.include('docx');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "file",
									"type": "file",
									"src": "{{projectRoot}}/tests/samples/sample.md"
								},
								{
									"key": "category",
									"value": "document",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/detect-targets",
							"host": ["{{baseUrl}}"],
							"path": ["detect-targets"]
						},
						"description": "检测 Markdown 文件可以转换成哪些格式"
					},
					"response": []
				},
				{
					"name": "MD to HTML",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has taskId', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('taskId');",
									"    pm.collectionVariables.set('taskId', jsonData.taskId);",
									"    console.log('Task ID saved:', jsonData.taskId);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "file",
									"type": "file",
									"src": "{{projectRoot}}/tests/samples/sample.md"
								},
								{
									"key": "category",
									"value": "document",
									"type": "text"
								},
								{
									"key": "target",
									"value": "html",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/convert/upload",
							"host": ["{{baseUrl}}"],
							"path": ["convert", "upload"]
						},
						"description": "测试 Markdown 转 HTML"
					},
					"response": []
				},
				{
					"name": "MD to PDF",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has taskId', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('taskId');",
									"    pm.collectionVariables.set('taskId', jsonData.taskId);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "file",
									"type": "file",
									"src": "{{projectRoot}}/tests/samples/sample.md"
								},
								{
									"key": "category",
									"value": "document",
									"type": "text"
								},
								{
									"key": "target",
									"value": "pdf",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/convert/upload",
							"host": ["{{baseUrl}}"],
							"path": ["convert", "upload"]
						},
						"description": "测试 Markdown 转 PDF"
					},
					"response": []
				},
				{
					"name": "MD to DOCX",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has taskId', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('taskId');",
									"    pm.collectionVariables.set('taskId', jsonData.taskId);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "file",
									"type": "file",
									"src": "{{projectRoot}}/tests/samples/sample.md"
								},
								{
									"key": "category",
									"value": "document",
									"type": "text"
								},
								{
									"key": "target",
									"value": "docx",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/convert/upload",
							"host": ["{{baseUrl}}"],
							"path": ["convert", "upload"]
						},
						"description": "测试 Markdown 转 Word 文档"
					},
					"response": []
				}
			],
			"description": "Markdown 文件转换测试"
		},
		{
			"name": "文件转换",
			"item": [
				{
					"name": "Detect Targets - PDF File",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has expected fields', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('filename');",
									"    pm.expect(jsonData).to.have.property('category');",
									"    pm.expect(jsonData).to.have.property('sourceExtension');",
									"    pm.expect(jsonData).to.have.property('supportedTargets');",
									"    pm.expect(jsonData).to.have.property('canConvert');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "file",
									"type": "file",
									"src": "{{projectRoot}}/tests/samples/sample.txt"
								},
								{
									"key": "category",
									"value": "document",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/detect-targets",
							"host": ["{{baseUrl}}"],
							"path": ["detect-targets"]
						},
						"description": "检测文件可以转换成哪些格式"
					},
					"response": []
				},
				{
					"name": "TXT to PDF",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has taskId', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('taskId');",
									"    pm.collectionVariables.set('taskId', jsonData.taskId);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "file",
									"type": "file",
									"src": "{{projectRoot}}/tests/samples/sample.txt"
								},
								{
									"key": "category",
									"value": "document",
									"type": "text"
								},
								{
									"key": "target",
									"value": "pdf",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/convert/upload",
							"host": ["{{baseUrl}}"],
							"path": ["convert", "upload"]
						},
						"description": "测试文本转PDF"
					},
					"response": []
				},
				{
					"name": "HTML to PDF",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has taskId', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('taskId');",
									"    pm.collectionVariables.set('taskId', jsonData.taskId);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "file",
									"type": "file",
									"src": "{{projectRoot}}/tests/samples/sample.html"
								},
								{
									"key": "category",
									"value": "document",
									"type": "text"
								},
								{
									"key": "target",
									"value": "pdf",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/convert/upload",
							"host": ["{{baseUrl}}"],
							"path": ["convert", "upload"]
						},
						"description": "测试HTML转PDF"
					},
					"response": []
				},
				{
					"name": "Get Task Status",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has state field', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('state');",
									"    pm.expect(['queued', 'processing', 'finished', 'error']).to.include(jsonData.state);",
									"});",
									"",
									"pm.test('If finished, has download URL', function () {",
									"    var jsonData = pm.response.json();",
									"    if (jsonData.state === 'finished') {",
									"        pm.expect(jsonData).to.have.property('url');",
									"        pm.expect(jsonData).to.have.property('downloadUrl');",
									"        pm.expect(jsonData).to.have.property('previewUrl');",
									"    }",
									"});",
									"",
									"var jsonData = pm.response.json();",
									"console.log('Task state:', jsonData.state);",
									"if (jsonData.state === 'finished') {",
									"    console.log('Download URL:', jsonData.downloadUrl);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/convert/task/{{taskId}}",
							"host": ["{{baseUrl}}"],
							"path": ["convert", "task", "{{taskId}}"]
						},
						"description": "查询转换任务状态"
					},
					"response": []
				}
			],
			"description": "文件上传和转换相关接口"
		},
		{
			"name": "错误处理测试",
			"item": [
				{
					"name": "Missing File (400)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 400 or 422', function () {",
									"    pm.expect([400, 422]).to.include(pm.response.code);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "category",
									"value": "document",
									"type": "text"
								},
								{
									"key": "target",
									"value": "pdf",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/convert/upload",
							"host": ["{{baseUrl}}"],
							"path": ["convert", "upload"]
						},
						"description": "测试缺少文件的错误"
					},
					"response": []
				},
				{
					"name": "Invalid Category (400)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 400', function () {",
									"    pm.response.to.have.status(400);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "file",
									"type": "file",
									"src": "{{projectRoot}}/tests/samples/sample.txt"
								},
								{
									"key": "category",
									"value": "invalid_category",
									"type": "text"
								},
								{
									"key": "target",
									"value": "pdf",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/convert/upload",
							"host": ["{{baseUrl}}"],
							"path": ["convert", "upload"]
						},
						"description": "测试无效分类的错误"
					},
					"response": []
				}
			],
			"description": "错误处理和边界情况测试"
		},
		{
			"name": "图片转换",
			"item": [
				{
					"name": "Detect Targets (Image)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Category is image', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.category).to.eql('image');",
									"});",
									"",
									"pm.test('Supported targets include png/pdf', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.supportedTargets).to.include('png');",
									"    pm.expect(jsonData.supportedTargets).to.include('pdf');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "file",
									"type": "file",
									"src": "{{projectRoot}}/tests/samples/sample.jpg"
								},
								{
									"key": "category",
									"value": "image",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/detect-targets",
							"host": ["{{baseUrl}}"],
							"path": ["detect-targets"]
						}
					},
					"response": []
				},
				{
					"name": "Convert Image to Image (JPG->PNG)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Task ID returned', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('taskId');",
									"    pm.collectionVariables.set('taskId', jsonData.taskId);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "file",
									"type": "file",
									"src": "{{projectRoot}}/tests/samples/sample.jpg"
								},
								{
									"key": "category",
									"value": "image",
									"type": "text"
								},
								{
									"key": "target",
									"value": "png",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/convert/upload",
							"host": ["{{baseUrl}}"],
							"path": ["convert", "upload"]
						}
					},
					"response": []
				},
				{
					"name": "Convert Image to PDF (PNG->PDF)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Task ID returned', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('taskId');",
									"    pm.collectionVariables.set('taskId', jsonData.taskId);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "file",
									"type": "file",
									"src": "{{projectRoot}}/tests/samples/sample.png"
								},
								{
									"key": "category",
									"value": "image",
									"type": "text"
								},
								{
									"key": "target",
									"value": "pdf",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/convert/upload",
							"host": ["{{baseUrl}}"],
							"path": ["convert", "upload"]
						}
					},
					"response": []
				}
			],
			"description": "图片格式转换测试"
		}
	]
}
