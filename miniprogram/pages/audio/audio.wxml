<view class="container">
  <view class="title">ğŸµ éŸ³é¢‘è½¬æ¢</view>

  <view class="card">
    <view class="subtitle">é€‰æ‹©æºæ–‡ä»¶æ ¼å¼</view>
    <view class="format-grid">
      <view class="format-item {{sourceIndex === 0 ? 'selected' : ''}}" bindtap="selectSourceFormat" data-index="0">
        <view class="format-text">MP3</view>
      </view>
      <view class="format-item {{sourceIndex === 1 ? 'selected' : ''}}" bindtap="selectSourceFormat" data-index="1">
        <view class="format-text">WAV</view>
      </view>
      <view class="format-item {{sourceIndex === 2 ? 'selected' : ''}}" bindtap="selectSourceFormat" data-index="2">
        <view class="format-text">AAC</view>
      </view>
      <view class="format-item {{sourceIndex === 3 ? 'selected' : ''}}" bindtap="selectSourceFormat" data-index="3">
        <view class="format-text">FLAC</view>
      </view>
      <view class="format-item {{sourceIndex === 4 ? 'selected' : ''}}" bindtap="selectSourceFormat" data-index="4">
        <view class="format-text">M4A</view>
      </view>
      <view class="format-item {{sourceIndex === 5 ? 'selected' : ''}}" bindtap="selectSourceFormat" data-index="5">
        <view class="format-text">OGG</view>
      </view>
      <view class="format-item {{sourceIndex === 6 ? 'selected' : ''}}" bindtap="selectSourceFormat" data-index="6">
        <view class="format-text">WMA</view>
      </view>
    </view>
  </view>

  <view class="card">
    <view class="subtitle">é€‰æ‹©ç›®æ ‡æ ¼å¼</view>
    <view class="format-grid">
      <view wx:for="{{availableTargets}}" wx:key="index" class="format-item {{targetIndex === index ? 'selected' : ''}}" bindtap="selectTargetFormat" data-index="{{index}}">
        <view class="format-text">{{item}}</view>
      </view>
      <view wx:if="{{availableTargets.length === 0}}" class="no-targets">
        <view class="muted">è¯·å…ˆé€‰æ‹©æºæ–‡ä»¶æ ¼å¼</view>
      </view>
    </view>
    <view class="muted" wx:if="{{availableTargets.length > 0}}">æ”¯æŒè½¬æ¢ä¸ºï¼š{{availableTargets.join('ã€')}}</view>
  </view>

  <view class="card">
    <view class="subtitle">é€‰æ‹©æ–‡ä»¶</view>
    <button type="default" bindtap="chooseFileAction" class="btn-primary">ğŸµ é€‰æ‹©éŸ³é¢‘æ–‡ä»¶</button>

    <view wx:if="{{fileList.length > 0}}" style="margin-top:24rpx">
      <block wx:for="{{fileList}}" wx:key="path">
        <view class="file-item">
          <view class="file-icon">ğŸµ</view>
          <view class="file-info">
            <view class="file-name">{{item.name}}</view>
            <view class="file-size">{{item.size}}</view>
          </view>
          <view class="file-actions">
            <view class="status-badge {{item.status === 'processing' ? 'status-processing' : item.status === 'success' ? 'status-success' : item.status === 'error' ? 'status-error' : ''}}">
              {{item.status === 'processing' ? 'è½¬æ¢ä¸­' : item.status === 'success' ? 'å®Œæˆ' : item.status === 'error' ? 'å¤±è´¥' : 'å¾…è½¬æ¢'}}
            </view>
            <view class="action-row">
              <button size="mini" data-index="{{index}}" bindtap="removeFile">åˆ é™¤</button>
              <button size="mini" data-index="{{index}}" bindtap="previewFile" wx:if="{{item.downloadUrl}}">é¢„è§ˆ</button>
              <button size="mini" data-index="{{index}}" bindtap="downloadFile" wx:if="{{item.downloadUrl}}">ä¸‹è½½</button>
              <button size="mini" data-index="{{index}}" bindtap="shareFile" wx:if="{{item.downloadUrl}}">åˆ†äº«</button>
            </view>
          </view>
        </view>
      </block>
    </view>
  </view>

  <view wx:if="{{converting}}" class="card">
    <view class="subtitle">è½¬æ¢è¿›åº¦</view>
    <view class="progress-container">
      <view class="progress-bar">
        <view class="progress-fill" style="{{'width:' + progress + '%'}}"></view>
      </view>
      <view class="progress-text">{{progressText}}</view>
    </view>
  </view>

  <view wx:if="{{fileList.length > 0 && availableTargets.length > 0}}" class="card">
    <button type="primary" loading="{{converting}}" disabled="{{converting}}" bindtap="startConvert" class="btn-success">
      {{converting ? 'è½¬æ¢ä¸­...' : 'å¼€å§‹è½¬æ¢'}}
    </button>
  </view>
</view>

<view wx:if="{{showPreviewModal}}" class="preview-overlay" bindtap="onOverlayTap">
  <view class="preview-sheet" catchtap="stopProp">
    <view class="sheet-header">
      <view class="sheet-title">{{previewName}}</view>
      <view class="close-btn" bindtap="closePreview">Ã—</view>
    </view>

    <view class="sheet-body">
      <view class="custom-player">
        <view class="play-btn" bindtap="togglePlay">
          {{isPlaying ? 'â¸' : 'â–¶ï¸'}}
        </view>
        <view class="progress-info">
          <text>{{currentTimeStr}}</text>
          <slider class="audio-slider"
                  value="{{currentProgress}}"
                  bindchange="seekAudio"
                  bindchanging="sliderChanging"
                  block-size="12"
                  activeColor="#667eea"/>
          <text>{{durationStr}}</text>
        </view>
      </view>

      <view class="sheet-info">
        <view class="muted">ç‚¹å‡»æŒ‰é’®æ’­æ”¾/æš‚åœ</view>
      </view>
    </view>
  </view>
</view>
