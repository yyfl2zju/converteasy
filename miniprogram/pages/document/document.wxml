<view class="container">
  <view class="title">ğŸ“„ æ–‡æ¡£è½¬æ¢</view>

  <view class="card">
    <view class="subtitle">é€‰æ‹©æºæ–‡ä»¶æ ¼å¼</view>
    <view class="format-grid">
      <view wx:for="{{sourceFormats}}" wx:key="index"
            class="format-item {{sourceIndex === index ? 'selected' : ''}}"
            bindtap="selectSourceFormat" data-index="{{index}}">
        <view class="format-text">{{sourceFormatDisplay[index]}}</view>
      </view>
    </view>
  </view>

  <view class="card">
    <view class="subtitle">é€‰æ‹©ç›®æ ‡æ ¼å¼</view>
    <view class="format-grid">
      <view wx:for="{{availableTargets}}" wx:key="index"
            class="format-item {{targetIndex === index ? 'selected' : ''}}"
            bindtap="selectTargetFormat" data-index="{{index}}">
        <view class="format-text">{{itemDisplayNames[index]}}</view>
      </view>
      <view wx:if="{{availableTargets.length === 0}}" class="no-targets">
        <view class="muted">{{sourceIndex === -1 ? 'è¯·å…ˆé€‰æ‹©æºæ–‡ä»¶æ ¼å¼' : 'è¯¥æ ¼å¼æš‚æ— æ”¯æŒçš„ç›®æ ‡æ ¼å¼'}}</view>
      </view>
    </view>
  </view>

  <view class="card">
    <view class="subtitle">é€‰æ‹©æ–‡ä»¶</view>
    <button type="default" bindtap="chooseFileAction" class="btn-primary">é€‰æ‹©æ–‡æ¡£æ–‡ä»¶ (ä»å¾®ä¿¡èŠå¤©)</button>

    <view wx:if="{{fileList.length > 0}}" style="margin-top:24rpx">
      <view wx:for="{{fileList}}" wx:key="path" class="file-item">
        <view class="file-icon">{{getFileIcon(item.name)}}</view>

        <view class="file-info">
          <view class="file-name">{{item.name}}</view>
          <view class="file-size">{{item.size}}</view>
          <view class="file-format">{{_getExt(item.name).toUpperCase()}}</view>
        </view>

        <view class="file-actions">
          <view class="status-badge {{item.status === 'processing' ? 'status-processing' : item.status === 'success' ? 'status-success' : item.status === 'error' ? 'status-error' : ''}}">
            {{item.status === 'processing' ? 'è½¬æ¢ä¸­' : item.status === 'success' ? 'å®Œæˆ' : item.status === 'error' ? 'å¤±è´¥' : 'å¾…è½¬æ¢'}}
          </view>
          <view class="action-row">
            <button size="mini" data-index="{{index}}" bindtap="removeFile">åˆ é™¤</button>
            <button size="mini" data-index="{{index}}" bindtap="previewFile" wx:if="{{item.downloadUrl}}">é¢„è§ˆ</button>
            <button size="mini" data-index="{{index}}" bindtap="downloadFile" wx:if="{{item.downloadUrl}}">ä¸‹è½½</button>
            <button size="mini" data-index="{{index}}" bindtap="shareFile" wx:if="{{item.downloadUrl}}">åˆ†äº«</button>
          </view>
        </view>
      </view>
    </view>
  </view>

  <view wx:if="{{converting}}" class="card">
    <view class="subtitle">è½¬æ¢è¿›åº¦</view>
    <view class="progress-container">
      <view class="progress-bar">
        <view class="progress-fill" style="width:{{progress}}%"></view>
      </view>
      <view class="progress-text">{{progressText}}</view>
    </view>
  </view>

  <view wx:if="{{fileList.length > 0 && availableTargets.length > 0}}" class="card">
    <button type="primary" loading="{{converting}}" disabled="{{converting}}" bindtap="startConvert" class="btn-success">
      {{converting ? 'è½¬æ¢ä¸­...' : 'å¼€å§‹è½¬æ¢'}}
    </button>
  </view>
</view>
